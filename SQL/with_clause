-- WITH helps simplify complex queries

WITH result AS (SELECT * FROM COMPANY) SELECT name FROM result;

-- RECURSIVE find sum of salaries smaller than 20000

WITH RECURSIVE t(n) AS (VALUES(0) UNION ALL SELECT SALARY FROM COMPANY WHERE SALARY <20000)
SELECT sum(n) FROM t;

-- UNION select from different tables UNION ALL removes duplicates

SELECT * FROM sales2007q1
UNION
SELECT * FROM sales2007q2;

-- copy values from one table to another and removed them
WITH removed_row AS (DELETE FROM COMPANY WHERE SALARY >= 30000 RETURNING *)
INSERT INTO COMPANY1 (SELECT * FROM removed_row);

-- RETURNING